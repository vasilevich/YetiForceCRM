{"version":3,"file":"ModuleImport.min.js","sources":["ModuleImport.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\njQuery.Class('Settings_Module_Import_Js', {}, {\n\t/**\n\t * Function to get import module step1 params\n\t */\n\tgetImportModuleStep1Params: function () {\n\t\tvar params = {\n\t\t\t'module': app.getModuleName(),\n\t\t\t'parent': app.getParentModuleName(),\n\t\t\t'view': 'ModuleImport'\n\t\t}\n\t\treturn params;\n\t},\n\n\t/**\n\t * Function to get import module with respect to view\n\t */\n\tgetImportModuleStepView: function (params) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\n\t/**\n\t * Function to register event for step1 of import module\n\t */\n\tregisterEventForStep1: function () {\n\t\tlet form = $('.js-validation-engine');\n\t\tform.validationEngine();\n\t\tthis.validationFileZipPath(form);\n\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\tapp.showScrollBar(jQuery('.extensionDescription'), {'height': '120px', 'width': '100%', 'railVisible': true});\n\t\tthis.registerEventsForImportModuleStep1(detailContentsHolder);\n\t},\n\n\t/**\n\t * Function to validation file zip\n\t */\n\tvalidationFileZipPath: function (form) {\n\t\tform.on('submit', function (e) {\n\t\t\tif (typeof form.data('submit') !== \"undefined\") {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tlet filePath = form.find('.js-validation-zip').val()\n\t\t\t\tlet fileParts = filePath.toLowerCase().split('.');\n\t\t\t\tlet fileType = fileParts[fileParts.length - 1];\n\t\t\t\tif (fileType == '') {\n\t\t\t\t\tlet errorMessage = app.vtranslate('JS_IMPORT_FILE_CAN_NOT_BE_EMPTY');\n\t\t\t\t\tlet params = {\n\t\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (fileType != 'zip') {\n\t\t\t\t\tlet errorMessage = app.vtranslate('JS_SELECT_FILE_EXTENSION') + '\\n' + '.zip';\n\t\t\t\t\tlet params = {\n\t\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Function to register event related to Import extrension Modules in step1\n\t */\n\tregisterEventsForImportModuleStep1: function (container) {\n\t\tvar thisInstance = this;\n\t\tjQuery(container).find('.installExtension').on('click', function (e) {\n\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\tvar extensionContainer = element.closest('.extension_container');\n\t\t\tvar extensionId = extensionContainer.find('[name=\"extensionId\"]').val();\n\t\t\tvar moduleAction = extensionContainer.find('[name=\"moduleAction\"]').val();\n\t\t\tvar extensionName = extensionContainer.find('[name=\"extensionName\"]').val();\n\t\t\tvar params = {\n\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t'parent': app.getParentModuleName(),\n\t\t\t\t'view': 'ModuleImport',\n\t\t\t\t'mode': 'step2',\n\t\t\t\t'extensionId': extensionId,\n\t\t\t\t'moduleAction': moduleAction,\n\t\t\t\t'extensionName': extensionName\n\t\t\t}\n\n\t\t\tthisInstance.getImportModuleStepView(params).done(function (data) {\n\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\tapp.showScrollBar(jQuery('#extensionLicense'), {'height': 'auto'});\n\t\t\t\tthisInstance.registerEventsForImportModuleStep2(detailContentsHolder);\n\t\t\t});\n\t\t})\n\t},\n\n\t/**\n\t * Function to register event related to Import extrension Modules in step2\n\t */\n\tregisterEventsForImportModuleStep2: function (container) {\n\t\tcontainer = jQuery(container);\n\t\tvar thisInstance = this;\n\n\t\tcontainer.find('#installExtension').on('click', function () {\n\t\t\tvar extensionId = jQuery('[name=\"extensionId\"]').val();\n\t\t\tvar targetModule = jQuery('[name=\"targetModule\"]').val();\n\t\t\tvar moduleType = jQuery('[name=\"moduleType\"]').val();\n\t\t\tvar moduleAction = jQuery('[name=\"moduleAction\"]').val();\n\t\t\tvar fileName = jQuery('[name=\"fileName\"]').val();\n\n\t\t\tvar params = {\n\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t'parent': app.getParentModuleName(),\n\t\t\t\t'view': 'ModuleImport',\n\t\t\t\t'mode': 'step3',\n\t\t\t\t'extensionId': extensionId,\n\t\t\t\t'moduleAction': moduleAction,\n\t\t\t\t'targetModule': targetModule,\n\t\t\t\t'moduleType': moduleType,\n\t\t\t\t'fileName': fileName\n\t\t\t}\n\n\t\t\tthisInstance.getImportModuleStepView(params).done(function (step3Data) {\n\t\t\t\tvar callBackFunction = function (data) {\n\t\t\t\t\tvar installationStatus = jQuery(data).find('[name=\"installationStatus\"]').val();\n\t\t\t\t\tif (installationStatus == \"success\") {\n\t\t\t\t\t\tjQuery('#installExtension').remove();\n\t\t\t\t\t}\n\t\t\t\t\tapp.showScrollBar(jQuery('#installationLog'), {'height': '150px'});\n\t\t\t\t\tjQuery(data).find('#importCompleted').on('click', function (e) {\n\t\t\t\t\t\tcontainer.find('#declineExtension').trigger('click');\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tvar modalData = {\n\t\t\t\t\tdata: step3Data,\n\t\t\t\t\tunblockcb: function () {\n\t\t\t\t\t\tcontainer.find('#declineExtension').trigger('click');\n\t\t\t\t\t},\n\t\t\t\t\tcss: {'width': '60%', 'height': '40%'},\n\t\t\t\t\tcb: callBackFunction\n\t\t\t\t};\n\t\t\t\tapp.showModalWindow(modalData);\n\t\t\t});\n\t\t})\n\n\t\tcontainer.find('#declineExtension').on('click', function () {\n\t\t\tvar params = thisInstance.getImportModuleStep1Params();\n\t\t\tthisInstance.getImportModuleStepView(params).done(function (data) {\n\t\t\t\tvar detailContentsHolder = jQuery('.contentsDiv');\n\t\t\t\tdetailContentsHolder.html(data);\n\t\t\t\tthisInstance.registerEventForStep1();\n\t\t\t});\n\t\t})\n\t},\n\n\tregisterEvents: function () {\n\t\tthis.registerEventForStep1();\n\t\t$('.js-form-import-module').on('submit', function() {\n\t\t\t$('.js-save-button').attr('disabled', true);\n\t\t});\n\t}\n});\n\n\njQuery(document).ready(function () {\n\tvar settingModuleImportInstance = new Settings_Module_Import_Js();\n\tsettingModuleImportInstance.registerEvents();\n})\n"],"names":["jQuery","Class","getImportModuleStep1Params","app","getModuleName","getParentModuleName","getImportModuleStepView","params","Deferred","progressIndicatorElement","progressIndicator","request","done","data","aDeferred","resolve","fail","error","reject","promise","registerEventForStep1","$","form","validationEngine","validationFileZipPath","showScrollBar","registerEventsForImportModuleStep1","detailContentsHolder","on","find","val","fileParts","filePath","toLowerCase","split","fileType","length","vtranslate","showMessage","text","errorMessage","type","container","e","currentTarget","extensionContainer","element","closest","extensionId","moduleAction","extensionName","thisInstance","html","registerEventsForImportModuleStep2","targetModule","moduleType","fileName","step3Data","showModalWindow","unblockcb","trigger","css","cb","remove","registerEvents","attr","document","ready","settingModuleImportInstance"],"mappings":"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"}