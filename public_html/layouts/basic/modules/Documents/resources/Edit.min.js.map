{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_Edit_Js(\n\t'Documents_Edit_Js',\n\t{},\n\t{\n\t\tINTERNAL_FILE_LOCATION_TYPE: 'I',\n\t\tEXTERNAL_FILE_LOCATION_TYPE: 'E',\n\n\t\tgetMaxiumFileUploadingSize: function(container) {\n\t\t\treturn container.find('.maxUploadSize').data('value');\n\t\t},\n\n\t\tisFileLocationInternalType: function(fileLocationElement) {\n\t\t\tif (fileLocationElement.val() == this.INTERNAL_FILE_LOCATION_TYPE) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\tisFileLocationExternalType: function(fileLocationElement) {\n\t\t\tif (fileLocationElement.val() == this.EXTERNAL_FILE_LOCATION_TYPE) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\tconvertFileSizeInToDisplayFormat: function(fileSizeInBytes) {\n\t\t\tvar i = -1;\n\t\t\tvar byteUnits = [' kB', ' MB', ' GB', ' TB', 'PB', 'EB', 'ZB', 'YB'];\n\t\t\tdo {\n\t\t\t\tfileSizeInBytes = fileSizeInBytes / 1024;\n\t\t\t\ti++;\n\t\t\t} while (fileSizeInBytes > 1024);\n\n\t\t\treturn Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];\n\t\t},\n\n\t\tregisterFileLocationTypeChangeEvent: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.on('change', 'select[name=\"filelocationtype\"]', function(e) {\n\t\t\t\tvar fileLocationTypeElement = container.find('[name=\"filelocationtype\"]');\n\t\t\t\tvar fileNameElement = container.find('[name=\"filename\"]');\n\t\t\t\tvar newFileNameElement;\n\t\t\t\tif (thisInstance.isFileLocationInternalType(fileLocationTypeElement)) {\n\t\t\t\t\tnewFileNameElement = jQuery('<input type=\"file\"/>');\n\t\t\t\t} else {\n\t\t\t\t\tnewFileNameElement = jQuery('<input type=\"text\" />');\n\t\t\t\t}\n\t\t\t\tvar oldElementAttributeList = fileNameElement.get(0).attributes;\n\n\t\t\t\tfor (var index = 0; index < oldElementAttributeList.length; index++) {\n\t\t\t\t\tvar attributeObject = oldElementAttributeList[index];\n\t\t\t\t\t//Dont update the type attribute\n\t\t\t\t\tif (attributeObject.name == 'type' || attributeObject.name == 'value' || attributeObject.name == 'class') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar value = attributeObject.value;\n\t\t\t\t\tvar className = '';\n\t\t\t\t\tif (attributeObject.name == 'data-fieldinfo') {\n\t\t\t\t\t\tvalue = JSON.parse(value);\n\t\t\t\t\t\tif (thisInstance.isFileLocationExternalType(fileLocationTypeElement)) {\n\t\t\t\t\t\t\tvalue['type'] = 'url';\n\t\t\t\t\t\t\tclassName = 'form-control';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvalue['type'] = 'file';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue = JSON.stringify(value);\n\t\t\t\t\t}\n\t\t\t\t\tnewFileNameElement.attr(attributeObject.name, value);\n\t\t\t\t\tnewFileNameElement.addClass(className);\n\t\t\t\t}\n\t\t\t\tfileNameElement.replaceWith(newFileNameElement);\n\t\t\t\tvar fileNameElementTd = newFileNameElement.closest('.fieldValue');\n\t\t\t\tvar uploadFileDetails = fileNameElementTd.find('.uploadedFileDetails');\n\t\t\t\tif (thisInstance.isFileLocationExternalType(fileLocationTypeElement)) {\n\t\t\t\t\tuploadFileDetails.addClass('d-none').removeClass('show');\n\t\t\t\t} else {\n\t\t\t\t\tuploadFileDetails.addClass('show').removeClass('d-none');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tregisterFileChangeEvent: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tcontainer.on('change', 'input[name=\"filename\"]', function(e) {\n\t\t\t\tif (e.target.type === 'text') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tlet element = container.find('[name=\"filename\"]');\n\t\t\t\t//ignore all other types than file\n\t\t\t\tif (element.attr('type') !== 'file') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet uploadFileSizeHolder = element.closest('.fileUploadContainer').find('.uploadedFileSize');\n\t\t\t\tlet fileSize = element.get(0).files[0].size;\n\t\t\t\tif (fileSize > thisInstance.getMaxiumFileUploadingSize(container)) {\n\t\t\t\t\tapp.showAlert(app.vtranslate('JS_EXCEEDS_MAX_UPLOAD_SIZE'));\n\t\t\t\t\telement.val('');\n\t\t\t\t\tuploadFileSizeHolder.text('');\n\t\t\t\t} else {\n\t\t\t\t\tuploadFileSizeHolder.text(thisInstance.convertFileSizeInToDisplayFormat(fileSize));\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Function to save the quickcreate module\n\t\t * @param accepts form element as parameter\n\t\t * @return returns deferred promise\n\t\t */\n\t\tquickCreateSave: function(form) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar aDeferred = jQuery.Deferred();\n\t\t\t//Using formData object to send data to server as a multipart/form-data form submit\n\t\t\tvar formData = new FormData(form[0]);\n\t\t\tvar fileLocationTypeElement = form.find('[name=\"filelocationtype\"]');\n\t\t\tvar params = {\n\t\t\t\turl: 'index.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: formData,\n\t\t\t\tprocessData: false,\n\t\t\t\tcontentType: false\n\t\t\t};\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function(textStatus, errorThrown) {\n\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\tregisterBasicEvents: function(container) {\n\t\t\tthis._super(container);\n\t\t\tthis.registerFileLocationTypeChangeEvent(container);\n\t\t\tthis.registerFileChangeEvent(container);\n\t\t},\n\n\t\tregisterEvents: function() {\n\t\t\tthis._super();\n\t\t}\n\t}\n);\n"],"names":["Vtiger_Edit_Js","INTERNAL_FILE_LOCATION_TYPE","EXTERNAL_FILE_LOCATION_TYPE","getMaxiumFileUploadingSize","container","find","data","isFileLocationInternalType","fileLocationElement","val","isFileLocationExternalType","convertFileSizeInToDisplayFormat","fileSizeInBytes","i","max","toFixed","registerFileLocationTypeChangeEvent","on","fileLocationTypeElement","fileNameElement","newFileNameElement","thisInstance","jQuery","oldElementAttributeList","get","attributes","index","length","attributeObject","name","value","className","JSON","parse","stringify","attr","addClass","replaceWith","closest","uploadFileDetails","fileNameElementTd","removeClass","registerFileChangeEvent","e","target","type","element","fileSize","files","size","app","showAlert","vtranslate","uploadFileSizeHolder","text","quickCreateSave","form","aDeferred","Deferred","formData","request","url","processData","contentType","done","resolve","fail","textStatus","errorThrown","reject","promise","registerBasicEvents","_super","registerEvents"],"mappings":"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"}