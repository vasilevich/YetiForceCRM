{"version":3,"file":"RecordConverter.min.js","sources":["RecordConverter.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n$.Class(\"Base_RecordConverter_JS\", {}, {\n\tcontainer: false,\n\t/**\n\t * Function get values for request query\n\t * @returns {{module: string, view: string, convertType: integer, fieldMerge: string, onlyBody: boolean, destinyModule: string, sourceView: string}}\n\t */\n\tgetParams: function () {\n\t\tlet params = {\n\t\t\tmodule: this.container.data('module'),\n\t\t\tview: this.container.data('view'),\n\t\t\tconvertType: this.container.find('.js-convert-type option:selected').val(),\n\t\t\tonlyBody: true,\n\t\t\tsourceView: app.getViewName()\n\t\t};\n\t\tif (app.getViewName() === 'List') {\n\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\tparams.selected_ids = listInstance.readSelectedIds(true);\n\t\t\tparams.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\tparams.cvId = listInstance.getCurrentCvId();\n\t\t\tif (listInstance.getListSearchInstance()) {\n\t\t\t\tlet searchValue = listInstance.getListSearchInstance().getAlphabetSearchValue();\n\t\t\t\tparams.search_params = JSON.stringify(listInstance.getListSearchInstance().getListSearchParams());\n\t\t\t\tif ((typeof searchValue != \"undefined\") && (searchValue.length > 0)) {\n\t\t\t\t\tparams.search_key = listInstance.getListSearchInstance().getAlphabetSearchField();\n\t\t\t\t\tparams.search_value = searchValue;\n\t\t\t\t\tparams.operator = 's';\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tparams.selected_ids = app.getRecordId()\n\t\t}\n\t\treturn params;\n\t},\n\t/**\n\t * Function load modal window\n\t * @returns {object}\n\t */\n\tloadModalWindow: function () {\n\t\tconst body = this.container.find('.js-modal-body')\n\t\tconst aDeferred = $.Deferred();\n\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true,\n\t\t\t\telementToBlock: body\n\t\t\t}\n\t\t});\n\t\tAppConnector.request(this.getParams()).then(function (responseData) {\n\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\tbody.html($(responseData).html());\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(body.find('.select2'));\n\t\t\taDeferred.resolve(responseData);\n\t\t}, function (textStatus, errorThrown) {\n\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * Function listener to change convert type\n\t */\n\tregisterChangeConvertType: function () {\n\t\tlet self = this;\n\t\tself.container.on('change', '.js-convert-type', (e) => {\n\t\t\tself.loadModalWindow();\n\t\t});\n\t},\n\t/**\n\t * Function listener to send a form\n\t * * @returns {object}\n\t */\n\tregisterSubmitForm: function () {\n\t\tlet self = this;\n\t\tself.container.on('click', \"[name='saveButton']\", (e) => {\n\t\t\tlet convertType = self.container.find('.js-convert-type option:selected').val();\n\t\t\tif (convertType) {\n\t\t\t\tlet formData = self.container.find('form').serializeFormData();\n\t\t\t\tlet postData = {};\n\t\t\t\tif (app.getViewName() === 'List') {\n\t\t\t\t\tlet listInstance = Vtiger_List_Js.getInstance();\n\t\t\t\t\tpostData = listInstance.getDefaultParams();\n\t\t\t\t\tpostData.selected_ids = listInstance.readSelectedIds(true);\n\t\t\t\t\tpostData.excluded_ids = listInstance.readExcludedIds(true);\n\t\t\t\t\tpostData.cvid = listInstance.getCurrentCvId();\n\n\t\t\t\t} else {\n\t\t\t\t\tpostData = {\n\t\t\t\t\t\tselected_ids: app.getRecordId()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpostData.convertType = convertType;\n\t\t\t\tpostData.viewInfo = app.getViewName();\n\t\t\t\tconst aDeferred = $.Deferred();\n\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\telementToBlock: self.container.find('.modal-body')\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tAppConnector.request($.extend(formData, postData)).done(function (responseData) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\tlet parseResult = JSON.parse(responseData);\n\t\t\t\t\tif (parseResult.result.redirect) {\n\t\t\t\t\t\twindow.location.href = parseResult.result.redirect;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (parseResult.result.createdRecords) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\ttext: app.vtranslate(parseResult.result.createdRecords),\n\t\t\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (parseResult.result.error) {\n\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\ttext: app.vtranslate(parseResult.result.error),\n\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t}\n\t\t\t\t\taDeferred.resolve(responseData);\n\t\t\t\t}, function (textStatus, errorThrown) {\n\t\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t\treturn aDeferred.promise();\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Register events function\n\t * @param modalContainer\n\t */\n\tregisterEvents: function (modalContainer) {\n\t\tthis.container = modalContainer;\n\t\tthis.registerChangeConvertType();\n\t\tthis.registerSubmitForm();\n\t}\n});\n"],"names":["$","Class","container","getParams","module","data","view","convertType","find","val","onlyBody","sourceView","app","getViewName","Vtiger_List_Js","getInstance","params","selected_ids","listInstance","readSelectedIds","excluded_ids","readExcludedIds","cvId","getCurrentCvId","getListSearchInstance","getAlphabetSearchValue","search_params","JSON","stringify","getListSearchParams","length","search_key","getAlphabetSearchField","search_value","searchValue","operator","getRecordId","loadModalWindow","aDeferred","Deferred","progressIndicatorElement","progressIndicator","blockInfo","enabled","elementToBlock","body","request","then","responseData","mode","html","App","Fields","Picklist","showSelect2ElementView","resolve","textStatus","errorThrown","reject","promise","registerChangeConvertType","self","on","registerSubmitForm","serializeFormData","postData","getDefaultParams","cvid","viewInfo","extend","formData","done","parse","parseResult","result","redirect","window","location","href","createdRecords","Vtiger_Helper_Js","showMessage","text","vtranslate","type","error","hideModalWindow","registerEvents","modalContainer"],"mappings":"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"}