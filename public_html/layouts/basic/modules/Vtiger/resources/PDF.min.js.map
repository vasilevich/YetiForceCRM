{"version":3,"file":"PDF.min.js","sources":["PDF.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class('Vtiger_PDF_Js', {\n\t/**\n\t * Proceed form submission\n\t */\n\tproceedSubmit(mode) {\n\t\tconst loader = $.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_PDF_GENERATING'),\n\t\t\tposition: 'html',\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tswitch (mode) {\n\t\t\tcase 'generate_pdf':\n\t\t\t\tbreak;\n\t\t\tcase 'single_pdf':\n\t\t\t\tthis.container.find('[name=\"single_pdf\"]').val(1);\n\t\t\t\tthis.container.find('#pdfExportModal').submit();\n\t\t\t\tbreak;\n\t\t\tcase 'email_pdf':\n\t\t\t\tthis.container.find('[name=\"email_pdf\"]').val(1);\n\t\t\t\tthis.container.find('#pdfExportModal').submit();\n\t\t\t\tbreak;\n\t\t}\n\t\tloader.progressIndicator({ mode: 'hide' });\n\t\tapp.hideModalWindow();\n\t},\n\n\t/*\n\t * Function to register the click event for generate button\n\t */\n\tregisterPreSubmitEvent: function(container) {\n\t\tconst self = this;\n\t\tcontainer.find('#generate_pdf, #single_pdf, #email_pdf').on('click', e => {\n\t\t\tself.proceedSubmit.apply(self, [$(e.currentTarget).attr('id')]);\n\t\t});\n\t},\n\n\t/**\n\t * Register list view check records\n\t *\n\t * @param   {jQuery}  container\n\t */\n\tregisterListViewCheckRecords(container) {\n\t\tlet templateElements = container.find('[name=\"pdf_template[]\"]');\n\t\ttemplateElements.on('change', function() {\n\t\t\tdocument.progressLoader = $.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_PDF_RECALCULATING'),\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlet templateContainer = $(this).closest('.js-pdf-template-content');\n\t\t\ttemplateContainer.find('.js-pdf-user-variable').toggleClass('d-none');\n\n\t\t\tlet templates = [];\n\t\t\ttemplateElements.filter(':checked').each(function() {\n\t\t\t\ttemplates.push($(this).val());\n\t\t\t});\n\n\t\t\tlet params = container.find('form').serializeFormData();\n\t\t\tparams.mode = 'validateRecords';\n\t\t\tparams.templates = templates;\n\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tvar response = data.result;\n\t\t\t\t\tif (data.success) {\n\t\t\t\t\t\tlet valid = response.valid;\n\t\t\t\t\t\tlet info = container\n\t\t\t\t\t\t\t.find('.js-records-info')\n\t\t\t\t\t\t\t.text(response.message)\n\t\t\t\t\t\t\t.removeClass('d-none');\n\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\tinfo.addClass('d-none');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tdocument.progressLoader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t}, 500);\n\n\t\t\t\t\t\tcontainer.find('.js-submit-button').each(function() {\n\t\t\t\t\t\t\t$(this).attr('disabled', !valid);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(data, err) {\n\t\t\t\t\tapp.errorLog(data, err);\n\t\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Register select custom columns change\n\t */\n\tregisterSelectCustomColumnsChange() {\n\t\tthis.container.find('[name=\"isCustomMode\"]').on('change', ev => {\n\t\t\tif ($(ev.target).is(':checked')) {\n\t\t\t\tthis.container.find('[name=\"inventoryColumns[]\"]').prop('disabled', null);\n\t\t\t\tthis.container.find('.js-save-scheme').prop('disabled', null);\n\t\t\t} else {\n\t\t\t\tthis.container.find('[name=\"inventoryColumns[]\"]').prop('disabled', 'disabled');\n\t\t\t\tthis.container.find('.js-save-scheme').prop('disabled', 'disabled');\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Register save scheme button click\n\t */\n\tregisterSaveInventoryColumnSchemeClick() {\n\t\tthis.container.find('.js-save-scheme').on('click', e => {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tconst loader = $.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlet params = this.container.find('form').serializeFormData();\n\t\t\tparams.mode = 'saveInventoryColumnScheme';\n\t\t\tparams.isCustomMode = this.container.find('[name=\"isCustomMode\"]').is(':checked');\n\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tconst response = data['result'];\n\t\t\t\t\tif (data['success']) {\n\t\t\t\t\t\tloader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t}\n\t\t\t\t\tif (response['message'] && data['success']) {\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function(data, err) {\n\t\t\t\t\tapp.errorLog(data, err);\n\t\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Register events\n\t */\n\tregisterEvents() {\n\t\tconst container = (this.container = $('#pdfExportModal').closest('.js-modal-container'));\n\t\tthis.dynamicTemplatesCount = 0;\n\t\tthis.recordId = parseInt(container.find('[name=\"record\"]').val());\n\t\tthis.registerPreSubmitEvent(container);\n\t\tthis.registerSaveInventoryColumnSchemeClick();\n\t\tthis.registerSelectCustomColumnsChange();\n\t\tthis.registerListViewCheckRecords(container);\n\t}\n});\n$(function() {\n\tnew Vtiger_PDF_Js().registerEvents();\n});\n"],"names":["$","Class","proceedSubmit","mode","progressIndicator","message","app","vtranslate","position","blockInfo","enabled","container","find","val","submit","loader","hideModalWindow","registerPreSubmitEvent","on","self","apply","e","currentTarget","attr","registerListViewCheckRecords","templateElements","document","progressLoader","closest","templateContainer","toggleClass","filter","each","templates","push","serializeFormData","params","AppConnector","request","done","data","result","success","response","valid","info","text","removeClass","addClass","setTimeout","fail","err","errorLog","registerSelectCustomColumnsChange","ev","target","is","prop","registerSaveInventoryColumnSchemeClick","preventDefault","stopPropagation","isCustomMode","showNotify","type","registerEvents","dynamicTemplatesCount","recordId","parseInt"],"mappings":";;AAGAA,EAAEC,KAAF,CAAQ,eAAR,CAAyB;;IAIxBC,aAJwB,wBAIVC,IAJU,CAIJ,CACnB,WAAeH,EAAEI,iBAAF,CAAoB,CAClCC,QAASC,IAAIC,UAAJ,CAAe,mBAAf,CADyB,CAElCC,SAAU,MAFwB,CAGlCC,UAAW,CACVC,UADU,CAHuB,CAApB,CAAf,CAOA,OAAQP,IAAR,EACC,IAAK,cAAL,CACC,MACD,IAAK,YAAL,CACC,KAAKQ,SAAL,CAAeC,IAAf,CAAoB,qBAApB,EAA2CC,GAA3C,CAA+C,CAA/C,CADD,CAEC,KAAKF,SAAL,CAAeC,IAAf,CAAoB,iBAApB,EAAuCE,MAAvC,EAFD,CAGC,MACD,IAAK,WAAL,CACC,KAAKH,SAAL,CAAeC,IAAf,CAAoB,oBAApB,EAA0CC,GAA1C,CAA8C,CAA9C,CADD,CAEC,KAAKF,SAAL,CAAeC,IAAf,CAAoB,iBAApB,EAAuCE,MAAvC,EAFD,CAPD,CAYAC,OAAOX,iBAAP,CAAyB,CAAED,KAAM,MAAR,CAAzB,CApBmB,CAqBnBG,IAAIU,eAAJ,GACA,CA1BuB;;IA+BxBC,uBAAwB,gCAASN,SAAT,CAAoB,CAC3C,SAAa,IAAb,CACAA,UAAUC,IAAV,CAAe,wCAAf,EAAyDM,EAAzD,CAA4D,OAA5D,CAAqE,WAAK,CACzEC,KAAKjB,aAAL,CAAmBkB,KAAnB,CAAyBD,IAAzB,CAA+B,CAACnB,EAAEqB,EAAEC,aAAJ,EAAmBC,IAAnB,CAAwB,IAAxB,CAAD,CAA/B,EACA,CAFD,EAGA,CApCuB;;;;IA2CxBC,4BA3CwB,uCA2CKb,SA3CL,CA2CgB,CACvC,qBAAuBA,UAAUC,IAAV,CAAe,yBAAf,CAAvB,CACAa,iBAAiBP,EAAjB,CAAoB,QAApB,CAA8B,UAAW,CACxCQ,SAASC,cAAT,CAA0B3B,EAAEI,iBAAF,CAAoB,CAC7CC,QAASC,IAAIC,UAAJ,CAAe,sBAAf,CADoC,CAE7CC,SAAU,MAFmC,CAG7CC,UAAW,CACVC,UADU,CAHkC,CAApB,CADc,CASxC,sBAAwBV,EAAE,IAAF,EAAQ4B,OAAR,CAAgB,0BAAhB,CAAxB,CACAC,kBAAkBjB,IAAlB,CAAuB,uBAAvB,EAAgDkB,WAAhD,CAA4D,QAA5D,CAVwC,CAYxC,cAAgB,EAAhB,CACAL,iBAAiBM,MAAjB,CAAwB,UAAxB,EAAoCC,IAApC,CAAyC,UAAW,CACnDC,UAAUC,IAAV,CAAelC,EAAE,IAAF,EAAQa,GAAR,EAAf,EACA,CAFD,CAbwC,CAiBxC,WAAaF,UAAUC,IAAV,CAAe,MAAf,EAAuBuB,iBAAvB,EAAb,CACAC,OAAOjC,IAAP,CAAc,iBAlB0B,CAmBxCiC,OAAOH,SAAP,CAAmBA,SAnBqB,CAqBxCI,aAAaC,OAAb,CAAqBF,MAArB,EACEG,IADF,CACO,SAASC,IAAT,CAAe,CACpB,aAAeA,KAAKC,MAApB,CACA,GAAID,KAAKE,OAAT,CAAkB,WACLC,SAASC,KADJ,CAEbC,KAAOlC,UACTC,IADS,CACJ,kBADI,EAETkC,IAFS,CAEJH,SAAStC,OAFL,EAGT0C,WAHS,CAGG,QAHH,CAFM,CAMbH,KANa,EAOhBC,KAAKG,QAAL,CAAc,QAAd,CAPgB,CASjBC,WAAW,UAAW,CACrBvB,SAASC,cAAT,CAAwBvB,iBAAxB,CAA0C,CAAED,KAAM,MAAR,CAA1C,EACA,CAFD,CAEG,GAFH,CATiB,CAajBQ,UAAUC,IAAV,CAAe,mBAAf,EAAoCoB,IAApC,CAAyC,UAAW,CACnDhC,EAAE,IAAF,EAAQuB,IAAR,CAAa,UAAb,CAAyB,CAACqB,KAA1B,EACA,CAFD,EAGA,CACD,CApBF,EAqBEM,IArBF,CAqBO,SAASV,IAAT,CAAeW,GAAf,CAAoB,CACzB7C,IAAI8C,QAAJ,CAAaZ,IAAb,CAAmBW,GAAnB,EACA,CAvBF,EAwBA,CA7CD,EA8CA,CA3FuB;;IAgGxBE,iCAhGwB,6CAgGY,gBACnC,KAAK1C,SAAL,CAAeC,IAAf,CAAoB,uBAApB,EAA6CM,EAA7C,CAAgD,QAAhD,CAA0D,YAAM,CAC3DlB,EAAEsD,GAAGC,MAAL,EAAaC,EAAb,CAAgB,UAAhB,CAD2D,EAE9D,MAAK7C,SAAL,CAAeC,IAAf,CAAoB,6BAApB,EAAmD6C,IAAnD,CAAwD,UAAxD,CAAoE,IAApE,CAF8D,CAG9D,MAAK9C,SAAL,CAAeC,IAAf,CAAoB,iBAApB,EAAuC6C,IAAvC,CAA4C,UAA5C,CAAwD,IAAxD,CAH8D,GAK9D,MAAK9C,SAAL,CAAeC,IAAf,CAAoB,6BAApB,EAAmD6C,IAAnD,CAAwD,UAAxD,CAAoE,UAApE,CAL8D,CAM9D,MAAK9C,SAAL,CAAeC,IAAf,CAAoB,iBAApB,EAAuC6C,IAAvC,CAA4C,UAA5C,CAAwD,UAAxD,CAN8D,EAQ/D,CARD,EASA,CA1GuB;;IA+GxBC,sCA/GwB,kDA+GiB,iBACxC,KAAK/C,SAAL,CAAeC,IAAf,CAAoB,iBAApB,EAAuCM,EAAvC,CAA0C,OAA1C,CAAmD,WAAK,CACvDG,EAAEsC,cAAF,EADuD,CAEvDtC,EAAEuC,eAAF,EAFuD,YAGxC5D,EAAEI,iBAAF,CAAoB,CAClCI,SAAU,MADwB,CAElCC,UAAW,CACVC,UADU,CAFuB,CAApB,CAHwC,CAUnD0B,OAAS,OAAKzB,SAAL,CAAeC,IAAf,CAAoB,MAApB,EAA4BuB,iBAA5B,EAV0C,CAWvDC,OAAOjC,IAAP,CAAc,2BAXyC,CAYvDiC,OAAOyB,YAAP,CAAsB,OAAKlD,SAAL,CAAeC,IAAf,CAAoB,uBAApB,EAA6C4C,EAA7C,CAAgD,UAAhD,CAZiC,CAcvDnB,aAAaC,OAAb,CAAqBF,MAArB,EACEG,IADF,CACO,SAASC,IAAT,CAAe,CACpB,aAAiBA,WAAjB,CACIA,YAFgB,EAGnBzB,OAAOX,iBAAP,CAAyB,CAAED,KAAM,MAAR,CAAzB,CAHmB,CAKhBwC,kBAAuBH,YALP,EAMnBlC,IAAIwD,UAAJ,CAAe,CACdhB,KAAMH,gBADQ,CAEdoB,KAAM,SAFQ,CAAf,EAKD,CAZF,EAaEb,IAbF,CAaO,SAASV,IAAT,CAAeW,GAAf,CAAoB,CACzB7C,IAAI8C,QAAJ,CAAaZ,IAAb,CAAmBW,GAAnB,EACA,CAfF,EAgBA,CA9BD,EA+BA,CA/IuB;;IAmJxBa,cAnJwB,0BAmJP,CAChB,cAAmB,KAAKrD,SAAL,CAAiBX,EAAE,iBAAF,EAAqB4B,OAArB,CAA6B,qBAA7B,CAApC,CACA,KAAKqC,qBAAL,CAA6B,CAFb,CAGhB,KAAKC,QAAL,CAAgBC,SAASxD,UAAUC,IAAV,CAAe,iBAAf,EAAkCC,GAAlC,EAAT,CAHA,CAIhB,KAAKI,sBAAL,CAA4BN,SAA5B,CAJgB,CAKhB,KAAK+C,sCAAL,EALgB,CAMhB,KAAKL,iCAAL,EANgB,CAOhB,KAAK7B,4BAAL,CAAkCb,SAAlC,EACA,CA3JuB,CAAzB,EA6JAX,EAAE,UAAW,CACZ,iBAAA,GAAoBgE,cAApB,GACA,CAFD"}